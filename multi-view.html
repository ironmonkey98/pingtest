<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>多视图WebRTC播放器 - 智能分辨率自适应</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <!-- 头部标题 -->
        <header class="page-header">
            <h1>多视图实时监控系统</h1>
            <div class="header-status">
                <span class="status-indicator" id="connectionStatus">
                    <span class="status-dot"></span>
                    <span class="status-text">未连接</span>
                </span>
            </div>
        </header>

        <!-- 布局切换控制 -->
        <div class="control-panel">
            <div class="control-group">
                <label class="control-label">视图布局</label>
                <div class="button-group">
                    <button class="btn btn-secondary" id="layoutSingle">
                        <span>📺 单视图</span>
                    </button>
                    <button class="btn btn-default" id="layoutGrid4">
                        <span>📱 四宫格</span>
                    </button>
                    <button class="btn btn-default" id="layoutGrid9">
                        <span>🔲 九宫格</span>
                    </button>
                </div>
            </div>

            <div class="control-group">
                <label class="control-label">全局控制</label>
                <div class="button-group">
                    <button class="btn btn-primary" id="connectAll">
                        <span>🎬 全部连接</span>
                    </button>
                    <button class="btn btn-default" id="disconnectAll">
                        <span>⏹️ 全部断开</span>
                    </button>
                    <button class="btn btn-default" id="autoOptimize">
                        <span>🤖 智能优化</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 多视图播放区域 -->
        <div class="video-section">
            <div id="multiViewContainer"></div>
            
            <!-- 布局切换器（悬浮） -->
            <div class="layout-switcher">
                <button class="layout-btn active" data-layout="single" title="单视图">
                    📺
                </button>
                <button class="layout-btn" data-layout="grid4" title="四宫格">
                    📱
                </button>
                <button class="layout-btn" data-layout="grid9" title="九宫格">
                    🔲
                </button>
            </div>
        </div>

        <!-- 监控面板 */
        <div class="monitor-section">
            <!-- 网络状态卡片 -->
            <div class="card">
                <div class="card-header">
                    <h3>网络状态</h3>
                    <span class="network-level" id="networkLevel">良好</span>
                </div>
                <div class="card-body">
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-label">网络类型</span>
                            <span class="stat-value" id="networkType">--</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">有效带宽</span>
                            <span class="stat-value" id="bandwidth">--</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">往返延迟 (RTT)</span>
                            <span class="stat-value" id="rtt">--</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">下行速度</span>
                            <span class="stat-value" id="downlink">--</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 多流统计卡片 -->
            <div class="card">
                <div class="card-header">
                    <h3>多流统计</h3>
                    <span class="status-tag status-success" id="overallStatus">正常</span>
                </div>
                <div class="card-body">
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-label">活跃流数量</span>
                            <span class="stat-value" id="activeStreamCount">0/1</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">总带宽消耗</span>
                            <span class="stat-value" id="totalBandwidthUsage">0 Mbps</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">平均帧率</span>
                            <span class="stat-value" id="averageFps">-- fps</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">平均丢包率</span>
                            <span class="stat-value" id="averagePacketLoss">--%</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">网络利用率</span>
                            <span class="stat-value" id="networkUtilization">--%</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">推荐布局</span>
                            <span class="stat-value" id="recommendedLayout">单视图</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 智能建议卡片 -->
            <div class="card">
                <div class="card-header">
                    <h3>智能建议</h3>
                    <button class="btn-icon" id="refreshRecommendations" title="刷新建议">🔄</button>
                </div>
                <div class="card-body">
                    <div id="recommendationsList" class="recommendations-list">
                        <div class="recommendation-item info">
                            <div class="recommendation-icon">💡</div>
                            <div class="recommendation-content">
                                <div class="recommendation-title">等待网络分析</div>
                                <div class="recommendation-desc">正在分析网络状况，稍后提供优化建议</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 切换历史记录 -->
            <div class="card">
                <div class="card-header">
                    <h3>切换记录</h3>
                    <button class="btn-icon" id="btnClearLog" title="清空记录">🗑️</button>
                </div>
                <div class="card-body">
                    <div class="log-container" id="logContainer">
                        <div class="log-empty">暂无切换记录</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 智能建议弹窗 -->
    <div id="recommendationModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>🤖 智能优化建议</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="modalRecommendations"></div>
                <div class="modal-actions">
                    <button class="btn btn-primary" id="applyRecommendations">应用建议</button>
                    <button class="btn btn-default" id="ignoreRecommendations">忽略</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript 模块 -->
    <script src="js/network-monitor.js"></script>
    <script src="js/webrtc-player-http.js"></script>
    <script src="js/stats-collector.js"></script>
    <script src="js/adaptive-controller.js"></script>
    <script src="js/multi-view-manager.js"></script>
    <script src="js/multi-stream-stats.js"></script>
    <script src="js/smart-quality-controller.js"></script>
    <script src="js/multi-view-app.js"></script>
</body>
</html>